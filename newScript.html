<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Table with Features</title>
  <style>
    table {
      border-collapse: collapse;
      table-layout: auto;   /* let browser auto-size cols */
      width: auto;          /* allow natural growth */
      max-width: 100%;      /* stop table from overflowing container */
    }
    td, th {
      border: 1px solid black;
      padding: 4px;
      min-width: 80px;
    }
    td {
      vertical-align: middle;
      white-space: pre;  /* preserve spaces and tabs */
    }
    .resizer {
      display: inline-block;
      width: 5px;
      cursor: col-resize;
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 1;
    }
    .bold {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <button onclick="addRow()">Add Row</button>
  <button onclick="addColumn()">Add Column</button>
  <button onclick="mergeCells()">Merge</button>
  <button onclick="splitCell()">Split</button>
  <button onclick="toggleBold()">Bold</button>
  <button onclick="downloadPDF()">Save as PDF</button>
  <br><br>
  <div id="tableContainer" style="position:relative; overflow:auto;"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    const tableContainer = document.getElementById("tableContainer");
    let table = document.createElement("table");
    tableContainer.appendChild(table);

    const numRows = 50;
    const numCols = 3;

    // Predefined text for column 1
    const col1Data = [
      "Item",
      "Application",
      "Reitz Fan Model",
      "Quantity",
      "Arrangement",
      "Impeller Type",
      "DUTY PARAMETERS",
      "Capacity at fan inlet",
      "Static Pressure difference",
      "Total Pressure",
      "Temperature",
      "Actual Density",
      "Dust content",
      "Fan speed",
      "Fan shaft power (without / with dust)",
      "Static efficiency (without / with dust)",
      "Total efficiency  (without / with dust)",
      "Minimum recommended capacity of motor",
      "GDÂ² of fan rotating parts ",
      "Full load torque",
      "Starting torque",      
      "CONSTRUCTIONAL FEATURES:",
      "1. IMPELLER",
      "    Diameter",
      "    Centre plate",
      "      Material",
      "      Thickness",
      "      Liners if any",
      "    Shroud",
      "      Material",
      "      Thickness",
      "    Blade",
      "      Material",
      "      Thickness",
      "      Liners if any",
      "    Tip speed",
      "    Weight of Impeller",
      "2. SHAFT",
      "    Material",
      "    Diameter at bearing",
      "    Critical speed",
      "    Shaft seal",
      "      Type",
      "      Material"
    ];

    // Build initial table
    for (let i = 0; i < numRows; i++) {
      let row = table.insertRow();
      for (let j = 0; j < numCols; j++) {
        let cell = row.insertCell();
        if (j === 0) {
          cell.textContent = (col1Data[i] || "");
        }
        cell.contentEditable = true;
        addResizer(cell);
      }
    }

    // Add row
    function addRow() {
      let row = table.insertRow();
      for (let j = 0; j < table.rows[0].cells.length; j++) {
        let cell = row.insertCell();
        if (j === 0) {
          cell.textContent = (table.rows.length) + ". ";
        }
        cell.contentEditable = true;
        addResizer(cell);
      }
    }

    // Add column
    function addColumn() {
      for (let i = 0; i < table.rows.length; i++) {
        let cell = table.rows[i].insertCell();
        cell.contentEditable = true;
        addResizer(cell);
      }
    }

    // Merge cells (fixed for GitHub Pages)
    function mergeCells() {
      let selection = window.getSelection();
      if (!selection.rangeCount) return;
      let range = selection.getRangeAt(0);

      let startNode = (range.startContainer.nodeType === 3) ? range.startContainer.parentNode : range.startContainer;
      let endNode = (range.endContainer.nodeType === 3) ? range.endContainer.parentNode : range.endContainer;

      let startCell = startNode.closest("td");
      let endCell = endNode.closest("td");
      if (!startCell || !endCell || startCell === endCell) return;

      let startRow = startCell.parentNode.rowIndex;
      let startCol = startCell.cellIndex;
      let endRow = endCell.parentNode.rowIndex;
      let endCol = endCell.cellIndex;

      for (let r = startRow; r <= endRow; r++) {
        for (let c = startCol; c <= endCol; c++) {
          if (r === startRow && c === startCol) {
            table.rows[r].cells[c].rowSpan = endRow - startRow + 1;
            table.rows[r].cells[c].colSpan = endCol - startCol + 1;
            table.rows[r].cells[c].style.textAlign = "center";
            table.rows[r].cells[c].style.verticalAlign = "middle";
          } else {
            table.rows[r].deleteCell(startCol);
          }
        }
      }
    }

    // Split cells (fixed for GitHub Pages)
    function splitCell() {
      let selection = window.getSelection();
      if (!selection.rangeCount) return;
      let range = selection.getRangeAt(0);

      let node = (range.startContainer.nodeType === 3) ? range.startContainer.parentNode : range.startContainer;
      let cell = node.closest("td");
      if (!cell || (cell.colSpan === 1 && cell.rowSpan === 1)) return;

      let rowIndex = cell.parentNode.rowIndex;
      let colIndex = cell.cellIndex;
      let rowSpan = cell.rowSpan;
      let colSpan = cell.colSpan;

      cell.rowSpan = 1;
      cell.colSpan = 1;

      for (let r = rowIndex; r < rowIndex + rowSpan; r++) {
        for (let c = colIndex; c < colIndex + colSpan; c++) {
          if (r === rowIndex && c === colIndex) continue;
          let newCell = table.rows[r].insertCell(c);
          newCell.contentEditable = true;
          addResizer(newCell);
        }
      }
    }

    // Toggle bold
    function toggleBold() {
      document.execCommand("bold", false, null);
    }

    // Column resizer
    function addResizer(cell) {
      let resizer = document.createElement("div");
      resizer.classList.add("resizer");
      cell.style.position = "relative";
      cell.appendChild(resizer);

      let startX, startWidth;
      resizer.addEventListener("mousedown", function (e) {
        startX = e.pageX;
        startWidth = cell.offsetWidth;
        document.addEventListener("mousemove", resize);
        document.addEventListener("mouseup", stopResize);
      });

      function resize(e) {
        let newWidth = startWidth + (e.pageX - startX);
        cell.style.width = newWidth + "px";
      }
      function stopResize() {
        document.removeEventListener("mousemove", resize);
        document.removeEventListener("mouseup", stopResize);
      }
    }

    // Export to PDF
    function downloadPDF() {
      const opt = {
        margin: 0.5,
        filename: "table.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
      };
      html2pdf().set(opt).from(tableContainer).save();
    }
  </script>
</body>
</html>
